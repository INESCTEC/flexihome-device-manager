[tox]
envlist=python3.9
skipsdist=True

[testenv]
deps=-r{toxinidir}/requirements.txt
     -r{toxinidir}/test-requirements.txt
	 {toxinidir}

commands=
   pytest --cov=device_manager_service -s --color=yes --code-highlight=yes
   ; timeout --signal=INT 40 pytest --cov=device_manager_service --full-trace --timeout=120 -s -vvv --color=yes --code-highlight=yes --assert=plain
   ; pytest --cov=device_manager_service --debug --timeout=30 -s -vvv --color=yes --code-highlight=yes

setenv =
   # Service envs
   DATABASE_IP={env:DATABASE_IP}
   DATABASE_PORT={env:DATABASE_PORT}
   DATABASE_USER={env:DATABASE_USER}
   DATABASE_PASSWORD={env:DATABASE_PASSWORD}
   KAFKA_BROKER_ENDPOINT={env:BOOTSTRAP_SERVERS}

   # Test database (account manager)
   ACCOUNT_MANAGER_ENDPOINT={env:ACCOUNT_MANAGER_ENDPOINT}
   DATABASE_IP_ACCOUNT={env:DATABASE_IP_ACCOUNT}
   DATABASE_PORT_ACCOUNT={env:DATABASE_PORT_ACCOUNT}
   DATABASE_USER_ACCOUNT={env:DATABASE_USER_ACCOUNT}
   DATABASE_PASSWORD_ACCOUNT={env:DATABASE_PASSWORD_ACCOUNT}
   JWT_SIGN_KEY={env:JWT_SIGN_KEY}
   GITLAB_CI_TEST={env:GITLAB_CI_TEST}
   TESTING={env:TESTING}


   # SSAs #

   # Whirlpool
   WHIRLPOOL_GA_URL={env:WHIRLPOOL_GA_URL}
   WHIRLPOOL_SERVICE_USER_EMAIL={env:WHIRLPOOL_SERVICE_USER_EMAIL}
   WHIRLPOOL_SERVICE_USER_PASSWORD={env:WHIRLPOOL_SERVICE_USER_PASSWORD}
   
   # User KB
   USER_KB_GA_URL={env:USER_KB_GA_URL}
   USER_KB_SERVICE_USER_EMAIL={env:USER_KB_SERVICE_USER_EMAIL}
   USER_KB_SERVICE_USER_PASSWORD={env:USER_KB_SERVICE_USER_PASSWORD}
   
   # BSH
   BSH_GA_URL={env:BSH_GA_URL}
   BSH_SERVICE_USER_EMAIL={env:BSH_SERVICE_USER_EMAIL}
   BSH_SERVICE_USER_PASSWORD={env:BSH_SERVICE_USER_PASSWORD}

   TEMPORAL_URL={env:TEMPORAL_URL}

passenv =
   GITLAB_DEPLOY_USERNAME
   GITLAB_SSA_MANAGER_DEPLOY_TOKEN
   GITLAB_DEPLOY_TOKEN
   GITLAB_SSA_DEPLOY_USERNAME
